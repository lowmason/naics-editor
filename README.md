# NAICS Code Editor and Search

This is a simple web application built with FastAPI and SQLite to search, browse, and edit NAICS (North American Industry Classification System) codes.

## Features

* **Search:** Full-text search across NAICS codes, titles, and descriptions.

* **Browse:** View the NAICS code hierarchy (Sectors, Subsectors, Industry Groups, etc.).

* **Edit (Non-Destructive):** Click on any description to edit it. Changes are now saved to a separate `naics_edits` table, leaving the original data intact. The application always shows you the edited version if one exists.

## Project Structure

```
.
├── main.py                   # FastAPI application
├── preprocess_data.py        # Script to download and preprocess data
├── to_parquet.py             # Script to create the SQLite DB
├── pyproject.toml            # Project configuration and dependencies (for uv)
├── static/
│   └── index.html            # The single-page HTML/JS frontend
├── naics_data.db             # SQLite database (generated by to_parquet.py)
├── naics_descriptions.parquet  # Preprocessed descriptions (generated by preprocess_data.py)
└── naics_descriptions_final.parquet # Final processed data (generated by to_parquet.py)



```

## How to Run (with `uv`)

This project uses `uv`, a high-performance Python package manager.

1. **Install `uv`:**
   If you don't have `uv`, you can install it via `pipx` (recommended) or `pip`:

   ```
   # With pipx (recommended)
   pipx install uv
   
   # Or with pip
   pip install uv
   ```

2. **Create and Activate Virtual Environment:**
   `uv` will create a virtual environment in the `.uv` directory.

   ```
   # Create the venv
   uv venv
   
   # Activate it (macOS/Linux)
   source .uv/bin/activate
   
   # Activate it (Windows PowerShell)
   .uv\Scripts\Activate.ps1
   ```

3. **Install Dependencies:**
   This command syncs your environment with the dependencies in `pyproject.toml`.

   ```
   uv pip sync pyproject.toml
   ```

4. **Generate the Data (Two-Step Pipeline):**
   Use `uv run` to execute the scripts within the managed environment.

   * **Step 1: Fetch and Preprocess Data**

     ```
     uv run python preprocess_data.py
    ```

   * **Step 2: Create the Database**

     ```
     uv run python to_parquet.py
     ```

   \***Note:** Running `to_parquet.py` will regenerate the entire database, including a new, empty `naics_edits` table. **This will erase all previous user edits.**

5. **Run the FastAPI Server:**

   ```
   uv run uvicorn main:app --reload
   ```

6. **Open the Application:**
   Navigate to `http://12_7.0.0.1:8000` in your web browser.

## API Endpoints

* `GET /`: Serves the `static/index.html` frontend.

* `GET /search`: Performs a full-text search. Returns original or edited descriptions.

  * Query param: `q` (e.g., `/search?q=software`)

* `GET /browse`: Browses the hierarchy. Returns original or edited descriptions.

  * Query param: `code` (e.g., `/browse?code=51`)

* `POST /update_description`: Saves an edit to the `naics_edits` table.

  * Body: `{ "code": "...", "description": "..." }`
